#! /bin/sh -e

# Copyright (c) 2009  Openismus GmbH  <http://www.openismus.com/>
#
# This file is part of mm-common.
#
# mm-common is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published
# by the Free Software Foundation, either version 2 of the License,
# or (at your option) any later version.
#
# mm-common is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with mm-common.  If not, see <http://www.gnu.org/licenses/>.

prefix="@prefix@"
datarootdir="@datarootdir@"
datadir="@datadir@"
pkgdatadir="${datadir}/@PACKAGE_TARNAME@"

progname="${0##*/}"
installcmd='ln -s'
instaction=symlinking
forceflag=
srcdir=.

for arg
do
  case $arg in
  '-?'|--help)
    cat <<EOF
Usage: $progname [OPTION]... [DIRECTORY]

Prepare a C++ binding module to use mm-common.

 -c, --copy          copy files rather than symlinking them
 -f, --force         replace existing files
     --help          display this help message
     --version       print version information
EOF
    exit 0
    ;;
  --version)
    echo "$progname @PACKAGE_VERSION@"
    exit 0
    ;;
  -c|--copy)
    installcmd=cp
    instaction=copying
    ;;
  -f|--force)
    forceflag=' -f'
    ;;
  -cf|-fc)
    installcmd=cp
    instaction=copying
    forceflag=' -f'
    ;;
  -*)
    echo "$progname: error: unrecognized option '$arg'" >&2
    exit 1
    ;;
  ?*)
    srcdir=$arg
    ;;
  esac
done

acfile=$srcdir/configure.ac

test -f "$acfile" || {
  echo "$progname: error: $acfile not found" >&2
  exit 1
}
# The sed expression contains literal tab characters for portability
auxdir=`sed -n 's/^[	 ]*AC_CONFIG_AUX_DIR([[	 ]*\([^]),$	 ]*\).*/\1/p' "$acfile"`
auxdir=$srcdir${auxdir:+/}$auxdir

echo "$progname: putting auxiliary files into $auxdir"

for file in compile-binding.am dist-changelog.am doc-reference.am generate-binding.am
do
  if test -n "$forceflag" || test ! -f "$auxdir/$file"; then
    echo "$progname: $instaction file $file"
    $installcmd$forceflag "$pkgdatadir/build/$file" "$auxdir/$file"
  fi
done

exit 0
